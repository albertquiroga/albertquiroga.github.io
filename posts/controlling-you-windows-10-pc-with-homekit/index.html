<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>Controlling your Windows 10 PC with HomeKit | Elaborative Encoding</title><meta name=description content="Albert Quiroga's personal site."><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="all,follow"><meta name=googlebot content="index,follow,snippet,archive"><meta property="og:title" content="Controlling your Windows 10 PC with HomeKit"><meta property="og:description" content="Lately I&rsquo;ve been going into a home automation spree, trying to automate my house as much as possible to avoid wasting time on repetitive stuff. While I am trying to not take it to the extreme, there&rsquo;s actually a lot of nifty stuff you can either buy or quickly &ldquo;hack&rdquo; with a Raspberry Pi to make your life much easier.
While I started by getting a cheap Echo Dot and running everything with Alexa, I quickly felt the system to be quite limited and messy - just like many other Amazon apps, the Alexa app has a very weird UI that seems to not have the main focus on home automation."><meta property="og:type" content="article"><meta property="og:url" content="https://albertquiroga.github.io/posts/controlling-you-windows-10-pc-with-homekit/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-01-25T00:00:00+01:00"><meta property="article:modified_time" content="2020-01-25T00:00:00+01:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Controlling your Windows 10 PC with HomeKit"><meta name=twitter:description content="Lately I&rsquo;ve been going into a home automation spree, trying to automate my house as much as possible to avoid wasting time on repetitive stuff. While I am trying to not take it to the extreme, there&rsquo;s actually a lot of nifty stuff you can either buy or quickly &ldquo;hack&rdquo; with a Raspberry Pi to make your life much easier.
While I started by getting a cheap Echo Dot and running everything with Alexa, I quickly felt the system to be quite limited and messy - just like many other Amazon apps, the Alexa app has a very weird UI that seems to not have the main focus on home automation."><link rel=stylesheet href=https://albertquiroga.github.io/css/style-dark.css><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script>
<script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel=icon type=image/png href=https://albertquiroga.github.io/images/favicon.ico></head><body class="max-width mx-auto px3 ltr"><div class="content index py4"><div id=header-post><a id=menu-icon href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=menu-icon-tablet href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=top-icon-tablet href=# onclick='$("html, body").animate({scrollTop:0},"fast")' style=display:none><i class="fas fa-chevron-up fa-lg"></i></a>
<span id=menu><span id=nav><ul><li><a href=/>Home</a></li><li><a href=/posts>Writings</a></li><li><a href=/tags>Tags</a></li><li><a href=/about>About</a></li></ul></span><br><span id=actions><ul><li><a class=icon href=https://albertquiroga.github.io/posts/elaborative-encoding/><i class="fas fa-chevron-left" aria-hidden=true onmouseover='$("#i-prev").toggle()' onmouseout='$("#i-prev").toggle()'></i></a></li><li><a class=icon href=https://albertquiroga.github.io/posts/spark-output-files-conundrum/><i class="fas fa-chevron-right" aria-hidden=true onmouseover='$("#i-next").toggle()' onmouseout='$("#i-next").toggle()'></i></a></li><li><a class=icon href=# onclick='$("html, body").animate({scrollTop:0},"fast")'><i class="fas fa-chevron-up" aria-hidden=true onmouseover='$("#i-top").toggle()' onmouseout='$("#i-top").toggle()'></i></a></li><li><a class=icon href=#><i class="fas fa-share-alt" aria-hidden=true onmouseover='$("#i-share").toggle()' onmouseout='$("#i-share").toggle()' onclick='return $("#share").toggle(),!1'></i></a></li></ul><span id=i-prev class=info style=display:none>Previous post</span>
<span id=i-next class=info style=display:none>Next post</span>
<span id=i-top class=info style=display:none>Back to top</span>
<span id=i-share class=info style=display:none>Share post</span></span><br><div id=share style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falbertquiroga.github.io%2fposts%2fcontrolling-you-windows-10-pc-with-homekit%2f"><i class="fab fa-facebook" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=https%3a%2f%2falbertquiroga.github.io%2fposts%2fcontrolling-you-windows-10-pc-with-homekit%2f&text=Controlling%20your%20Windows%2010%20PC%20with%20HomeKit"><i class="fab fa-twitter" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falbertquiroga.github.io%2fposts%2fcontrolling-you-windows-10-pc-with-homekit%2f&title=Controlling%20your%20Windows%2010%20PC%20with%20HomeKit"><i class="fab fa-linkedin" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falbertquiroga.github.io%2fposts%2fcontrolling-you-windows-10-pc-with-homekit%2f&is_video=false&description=Controlling%20your%20Windows%2010%20PC%20with%20HomeKit"><i class="fab fa-pinterest" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=Controlling%20your%20Windows%2010%20PC%20with%20HomeKit&body=Check out this article: https%3a%2f%2falbertquiroga.github.io%2fposts%2fcontrolling-you-windows-10-pc-with-homekit%2f"><i class="fas fa-envelope" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=https%3a%2f%2falbertquiroga.github.io%2fposts%2fcontrolling-you-windows-10-pc-with-homekit%2f&title=Controlling%20your%20Windows%2010%20PC%20with%20HomeKit"><i class="fab fa-get-pocket" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=https%3a%2f%2falbertquiroga.github.io%2fposts%2fcontrolling-you-windows-10-pc-with-homekit%2f&title=Controlling%20your%20Windows%2010%20PC%20with%20HomeKit"><i class="fab fa-reddit" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2falbertquiroga.github.io%2fposts%2fcontrolling-you-windows-10-pc-with-homekit%2f&name=Controlling%20your%20Windows%2010%20PC%20with%20HomeKit&description=Lately%20I%26rsquo%3bve%20been%20going%20into%20a%20home%20automation%20spree%2c%20trying%20to%20automate%20my%20house%20as%20much%20as%20possible%20to%20avoid%20wasting%20time%20on%20repetitive%20stuff.%20While%20I%20am%20trying%20to%20not%20take%20it%20to%20the%20extreme%2c%20there%26rsquo%3bs%20actually%20a%20lot%20of%20nifty%20stuff%20you%20can%20either%20buy%20or%20quickly%20%26ldquo%3bhack%26rdquo%3b%20with%20a%20Raspberry%20Pi%20to%20make%20your%20life%20much%20easier.%0aWhile%20I%20started%20by%20getting%20a%20cheap%20Echo%20Dot%20and%20running%20everything%20with%20Alexa%2c%20I%20quickly%20felt%20the%20system%20to%20be%20quite%20limited%20and%20messy%20-%20just%20like%20many%20other%20Amazon%20apps%2c%20the%20Alexa%20app%20has%20a%20very%20weird%20UI%20that%20seems%20to%20not%20have%20the%20main%20focus%20on%20home%20automation."><i class="fab fa-tumblr" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2falbertquiroga.github.io%2fposts%2fcontrolling-you-windows-10-pc-with-homekit%2f&t=Controlling%20your%20Windows%2010%20PC%20with%20HomeKit"><i class="fab fa-hacker-news" aria-hidden=true></i></a></li></ul></div><div id=toc><nav id=TableOfContents></nav></div></span></div><article class=post itemscope itemtype=http://schema.org/BlogPosting><header><h1 class=posttitle itemprop="name headline">Controlling your Windows 10 PC with HomeKit</h1><div class=meta><div class=postdate><time datetime="2020-01-25 00:00:00 +0100 +0100" itemprop=datePublished>2020-01-25</time></div><div class=article-tag><i class="fas fa-tag"></i>
<a class=tag-link href=/tags/home-automation rel=tag>home automation</a>
,
<a class=tag-link href=/tags/homekit rel=tag>homekit</a></div></div></header><div class=content itemprop=articleBody><p>Lately I&rsquo;ve been going into a home automation spree, trying to automate my house as much as possible to avoid wasting time on repetitive stuff. While I am trying to not take it to <a href=https://github.com/NARKOZ/hacker-scripts>the extreme</a>, there&rsquo;s actually a lot of nifty stuff you can either buy or quickly &ldquo;hack&rdquo; with a Raspberry Pi to make your life much easier.</p><p>While I started by getting a cheap Echo Dot and running everything with Alexa, I quickly felt the system to be quite limited and messy - just like many other Amazon apps, the Alexa app has a very weird UI that seems to not have the main focus on home automation. Also, the routines you can build in there are quite limited. So I decided to look for alternatives:</p><ul><li><a href=https://store.google.com/ie/category/connected_home>Google&rsquo;s solutions</a> seem to be pretty good, but I don&rsquo;t want to wire tap my entire house for them.</li><li><a href=https://www.home-assistant.io/>Home Assistant</a> and the rest of the &ldquo;indie&rdquo; solutions are very powerful, but a pain in the arse to set up and configure, and they also don&rsquo;t give me the confidence that a solution backed by a big company does. You also need to pay a monthly subscription to have access to everything.</li><li><a href=https://developer.apple.com/homekit/>Apple&rsquo;s HomeKit</a> is on a very weird spot because of their greediness with the MFi program. While being a very robust and technically compliant solution, and being the only AAA option that seems to respect your privacy, there very few accessories that work with it and the ones that do tend to be quite expensive. That is, until you find <a href=https://homebridge.io/>Homebridge</a>.</li></ul><p>Homebridge is a NodeJS solution that runs as a server and basically emulates a bridge (like the ones you get with stuff like Phillips Hue) through which you can add your own programmed accessories. You define your own scripts (that do things like interact with the REST API of a smart plug to control it), and Homebridge will expose them to HomeKit as HomeKit-defined accessories.</p><p>This means that anyone with enough skills can define Homekit accessories that not just control smart home stuff, but basically do anything. You can define a light switch in Homekit that instead of controlling a light, runs an SSH command. Or in the case of this blogpost, you can run a complex set of commands to turn on, monitor and turn off a Windows PC - like <a href=https://github.com/AlexGustafsson>Alex Gustaffson</a> did in <a href=https://www.npmjs.com/package/homebridge-wol>homebridge-wol</a>.</p><p>Since Microsoft woke up and started doing interesting stuff with Windows 10 now <a href="https://news.ycombinator.com/item?id=15904265">you can remotely control your PC via SSH</a>, which means you can turn it on/off at will from something like a Raspberry Pi.</p><p>Let&rsquo;s get started.</p><h1 id=getting-the-openssh-server-in-windows-10>Getting the OpenSSH server in Windows 10</h1><p>Microsoft prepared <a href=https://docs.microsoft.com/en-us/windows-server/administration/openssh/openssh_install_firstuse>very good docs for it</a>, but basically:</p><ol><li>Go to Windows 10 settings</li><li>Go to apps</li><li>Click in &lsquo;Optional features&rsquo;</li><li>Click in &lsquo;Add a feature&rsquo;</li><li>Select &lsquo;OpenSSH server&rsquo;. You can install the client too for fun.</li><li>Reboot</li></ol><p>Now there will be a new service for the SSH daemon, which you will have to configure to accept incoming connections. Since we are not idiots we&rsquo;ll also configure it to reject password authentication and only accept SSH keys. The configuration process for this is a pain in the arse due to the differences between Linux users and Windows ones, and user <a href=https://stackoverflow.com/users/31782/n0rd>n0rd</a> made <a href=https://stackoverflow.com/a/50502015>a very good guide for it in StackOverflow</a>. Follow it to generate the keys and configure the service properly, then edit the <code>C:\ProgramData\ssh\sshd_config</code> file to set the <code>#PasswordAuthentication yes</code> to <code>PasswordAuthentication no</code>.</p><p>If you are wondering what your Windows username is (since Microsoft made a clusterfuck of it now that you login with your Microsoft account), you can retrieve it via the windows shell:</p><ol><li>In Windows, press the Windows key + R</li><li>Type <code>cmd</code>, hit enter</li><li>In the command shell, use the <code>whoami</code> command to get your username. You&rsquo;ll get something like:</li></ol><p><code>DESKTOP\john</code></p><p>The username is the &lsquo;john&rsquo; part, &lsquo;DESKTOP&rsquo; is your computer&rsquo;s network name which is not needed.</p><p>You will also have to configure <a href=https://en.wikipedia.org/wiki/Wake-on-LAN>wake-on-lan</a> for your computer. There&rsquo;s a lot of tutorials online for it (like <a href="https://www.google.com/url?sa=t&rct=j&q=&esrc=s&source=web&cd=3&cad=rja&uact=8&ved=2ahUKEwiq6ej2_p7nAhW0QUEAHf-3BWIQFjACegQIDBAH&url=https%3A%2F%2Fwww.groovypost.com%2Fhowto%2Fenable-wake-on-lan-windows-10%2F&usg=AOvVaw2f4sTifO9oM4WmI7Rz4Qaw">this one</a>) so I won&rsquo;t go through it, but keep in mind this is something you&rsquo;ll most likely also need to enable on the BIOS for it to work - and not all motherboards support it. Google your motherboard model plus &lsquo;wake on lan&rsquo; for more info.</p><p>Now you can try to log into your computer and control it. Log into a second computer within the same LAN and ssh into your Windows computer:</p><p><code>ssh -i &lt;your_private_key_file> &lt;username>@&lt;ip_address></code></p><p>If it worked, you should see the Windows command shell. Run the following to initiate shutdown in 30 seconds:</p><p><code>shutdown /a /t 30</code></p><p>You should see a system notification in your Windows computer warning you of the remote-initiated shutdown, and the computer should automatically power off in 30 seconds. Now in order to wake it up, send a magic packet to the MAC address of your computer&rsquo;s network interface. If you are running this from a Raspberry Pi you&rsquo;ll probably have Raspbian which means you&rsquo;ll have the <code>wakeonlan</code> command already available, but if not a quick Google search should show you a thousand billion tools to do it:</p><p><code>wakeonlan &lt;your_mac_address></code></p><p>Your computer should now boot up if wake-on-lan is properly configured.</p><h1 id=installing-and-configuring-homebridge>Installing and configuring Homebridge</h1><p>I would simply recommend Homebridge&rsquo;s own tutorials on how to install the software and run it as a service, they are very good. Again, you should probably run this on Raspbian so the guide would be <a href=https://github.com/nfarina/homebridge/wiki/Install-Homebridge-on-Raspbian>this one</a>. Once it&rsquo;s installed, install the <code>homebridge-wol</code> package through npm. Now there&rsquo;s a small modification you&rsquo;ll have to do to the process detailed in the Homebridge wiki: in order to run ssh commands, the <code>homebridge</code> service user you create in the guide will need a home directory to create the <code>.ssh</code> directory. You can do so by running:</p><p><code>mkhomedir_helper homebridge</code></p><p>Keep in mind you&rsquo;ll also need to provide the private key to authenticate via SSH in a directory that is accesible by the <code>homebridge</code> user.</p><p>Now you&rsquo;ll have to add your Windows laptop to Homebridge as an accessory. Here&rsquo;s a configuration sample, similar to the ones found in the <code>homebridge-wol</code> package information:</p><pre tabindex=0><code>&#34;accessories&#34;: [
 {
   &#34;accessory&#34;: &#34;NetworkDevice&#34;,
   &#34;name&#34;: &#34;Windows PC&#34;,
   &#34;mac&#34;: &#34;&lt;your_mac_address&gt;&#34;,
   &#34;ip&#34;: &#34;&lt;your_ip_address&gt;&#34;,
   &#34;pingInterval&#34;: 30,
   &#34;wakeGraceTime&#34;: 30,
   &#34;shutdownGraceTime&#34;: 30,
   &#34;shutdownCommand&#34;: &#34;ssh -i &lt;your_ssh_key&gt; &lt;username&gt;@&lt;your_ip_address&gt; shutdown /s /t 15&#34;
 }
]
</code></pre><p>Restart the Homebridge service and your Windows computer should show up as a lights switch in your iOS Home app.</p><p>Enjoy!</p></div></article><div id=footer-post-container><div id=footer-post><div id=nav-footer style=display:none><ul><li><a href=/>Home</a></li><li><a href=/posts>Writings</a></li><li><a href=/tags>Tags</a></li><li><a href=/about>About</a></li></ul></div><div id=toc-footer style=display:none><nav id=TableOfContents></nav></div><div id=share-footer style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falbertquiroga.github.io%2fposts%2fcontrolling-you-windows-10-pc-with-homekit%2f"><i class="fab fa-facebook fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=https%3a%2f%2falbertquiroga.github.io%2fposts%2fcontrolling-you-windows-10-pc-with-homekit%2f&text=Controlling%20your%20Windows%2010%20PC%20with%20HomeKit"><i class="fab fa-twitter fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falbertquiroga.github.io%2fposts%2fcontrolling-you-windows-10-pc-with-homekit%2f&title=Controlling%20your%20Windows%2010%20PC%20with%20HomeKit"><i class="fab fa-linkedin fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falbertquiroga.github.io%2fposts%2fcontrolling-you-windows-10-pc-with-homekit%2f&is_video=false&description=Controlling%20your%20Windows%2010%20PC%20with%20HomeKit"><i class="fab fa-pinterest fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=Controlling%20your%20Windows%2010%20PC%20with%20HomeKit&body=Check out this article: https%3a%2f%2falbertquiroga.github.io%2fposts%2fcontrolling-you-windows-10-pc-with-homekit%2f"><i class="fas fa-envelope fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=https%3a%2f%2falbertquiroga.github.io%2fposts%2fcontrolling-you-windows-10-pc-with-homekit%2f&title=Controlling%20your%20Windows%2010%20PC%20with%20HomeKit"><i class="fab fa-get-pocket fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=https%3a%2f%2falbertquiroga.github.io%2fposts%2fcontrolling-you-windows-10-pc-with-homekit%2f&title=Controlling%20your%20Windows%2010%20PC%20with%20HomeKit"><i class="fab fa-reddit fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2falbertquiroga.github.io%2fposts%2fcontrolling-you-windows-10-pc-with-homekit%2f&name=Controlling%20your%20Windows%2010%20PC%20with%20HomeKit&description=Lately%20I%26rsquo%3bve%20been%20going%20into%20a%20home%20automation%20spree%2c%20trying%20to%20automate%20my%20house%20as%20much%20as%20possible%20to%20avoid%20wasting%20time%20on%20repetitive%20stuff.%20While%20I%20am%20trying%20to%20not%20take%20it%20to%20the%20extreme%2c%20there%26rsquo%3bs%20actually%20a%20lot%20of%20nifty%20stuff%20you%20can%20either%20buy%20or%20quickly%20%26ldquo%3bhack%26rdquo%3b%20with%20a%20Raspberry%20Pi%20to%20make%20your%20life%20much%20easier.%0aWhile%20I%20started%20by%20getting%20a%20cheap%20Echo%20Dot%20and%20running%20everything%20with%20Alexa%2c%20I%20quickly%20felt%20the%20system%20to%20be%20quite%20limited%20and%20messy%20-%20just%20like%20many%20other%20Amazon%20apps%2c%20the%20Alexa%20app%20has%20a%20very%20weird%20UI%20that%20seems%20to%20not%20have%20the%20main%20focus%20on%20home%20automation."><i class="fab fa-tumblr fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2falbertquiroga.github.io%2fposts%2fcontrolling-you-windows-10-pc-with-homekit%2f&t=Controlling%20your%20Windows%2010%20PC%20with%20HomeKit"><i class="fab fa-hacker-news fa-lg" aria-hidden=true></i></a></li></ul></div><div id=actions-footer><a id=menu class=icon href=# onclick='return $("#nav-footer").toggle(),!1'><i class="fas fa-bars fa-lg" aria-hidden=true></i> Menu</a>
<a id=toc class=icon href=# onclick='return $("#toc-footer").toggle(),!1'><i class="fas fa-list fa-lg" aria-hidden=true></i> TOC</a>
<a id=share class=icon href=# onclick='return $("#share-footer").toggle(),!1'><i class="fas fa-share-alt fa-lg" aria-hidden=true></i> share</a>
<a id=top style=display:none class=icon href=# onclick='$("html, body").animate({scrollTop:0},"fast")'><i class="fas fa-chevron-up fa-lg" aria-hidden=true></i> Top</a></div></div></div><footer id=footer><div class=footer-left>Copyright &copy; 2022 Albert Quiroga</div><div class=footer-right><nav><ul><li><a href=/>Home</a></li><li><a href=/posts>Writings</a></li><li><a href=/tags>Tags</a></li><li><a href=/about>About</a></li></ul></nav></div></footer></div></body><link rel=stylesheet href=/lib/font-awesome/css/all.min.css><script src=/lib/jquery/jquery.min.js></script>
<script src=/js/main.js></script></html>